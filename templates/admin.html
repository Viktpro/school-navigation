<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –ú–ë–û–£ –°–û–® ‚Ññ1</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #2d3748;
    }

    /* –®–∞–ø–∫–∞ */
    .modern-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border-bottom: 3px solid #f39c12;
    }

    .header-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .logo-image img {
      height: 50px;
      width: auto;
    }

    .logo-text {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2d3748;
    }

    .nav-links {
      display: flex;
      gap: 1rem;
    }

    .nav-link {
      color: #4a5568;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: all 0.3s;
    }

    .nav-link:hover {
      background: #667eea20;
    }

    .nav-link.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .admin-container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }

    /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ */
    .login-screen {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 400px;
      margin: 40px auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .login-screen h2 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      color: #2d3748;
    }

    .login-screen p {
      color: #718096;
      margin-bottom: 30px;
    }

    .password-input {
      width: 100%;
      padding: 15px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 1rem;
      margin-bottom: 20px;
      font-family: 'Inter', sans-serif;
    }

    .password-input:focus {
      border-color: #667eea;
      outline: none;
    }

    .login-button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .login-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .error-message {
      color: #e53e3e;
      margin-top: 15px;
      display: none;
    }

    /* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
    .admin-panel {
      display: none;
    }

    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      background: white;
      padding: 20px;
      border-radius: 12px;
    }

    .admin-header h1 {
      font-size: 2rem;
      color: #2d3748;
    }

    .logout-button {
      padding: 10px 20px;
      background: #e53e3e;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: #667eea;
    }

    .stat-label {
      color: #718096;
      margin-top: 5px;
    }

    .panel {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }

    .panel h2 {
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background: #f7fafc;
      font-weight: 600;
    }

    .action-button {
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 0 2px;
    }

    .action-button.edit {
      background: #667eea20;
      color: #667eea;
    }

    .action-button.delete {
      background: #fc818120;
      color: #c53030;
    }

    .add-button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 20px;
    }

    footer {
      text-align: center;
      padding: 2rem;
      color: rgba(255, 255, 255, 0.8);
    }
  </style>
</head>
<body>
  <header class="modern-header">
    <div class="header-container">
      <div class="logo-section">
        <div class="logo-image">
          <img src="/static/images/school_logo.png" alt="–ú–ë–û–£ –°–û–® ‚Ññ1">
        </div>
        <div class="logo-text">–ú–ë–û–£ –°–û–® ‚Ññ1</div>
      </div>

      <div class="nav-links">
        <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/viewer" class="nav-link">–ù–∞–≤–∏–≥–∞—Ç–æ—Ä</a>
        <a href="/admin" class="nav-link active">–ê–¥–º–∏–Ω–∫–∞</a>
      </div>
    </div>
  </header>

  <div class="admin-container">
    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div id="login-screen" class="login-screen">
      <h2>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
      <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é</p>
      <input type="password" id="password-input" class="password-input" placeholder="–ü–∞—Ä–æ–ª—å">
      <button onclick="checkPassword()" class="login-button">–í–æ–π—Ç–∏</button>
      <div id="login-error" class="error-message">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>
    </div>

    <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Å–∫—Ä—ã—Ç–∞) -->
    <div id="admin-panel" class="admin-panel">
      <div class="admin-header">
        <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
        <button onclick="logout()" class="logout-button">–í—ã–π—Ç–∏</button>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="total-points">35</div>
          <div class="stat-label">–õ–æ–∫–∞—Ü–∏–π</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="total-routes">28</div>
          <div class="stat-label">–ú–∞—Ä—à—Ä—É—Ç–æ–≤</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="today-stats">47</div>
          <div class="stat-label">–ù–∞–≤–∏–≥–∞—Ü–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="total-navigations">312</div>
          <div class="stat-label">–í—Å–µ–≥–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–π</div>
        </div>
      </div>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏—è–º–∏ -->
      <div class="panel">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏—è–º–∏</h2>
        <button class="add-button" onclick="showAddForm()">+ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (—Å–∫—Ä—ã—Ç–∞) -->
        <div id="add-form" style="display: none; margin-bottom: 20px;">
          <input type="text" id="point-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
          <select id="point-category" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
            <option value="classroom">–ö–ª–∞—Å—Å</option>
            <option value="entrance">–í—Ö–æ–¥</option>
            <option value="toilet">–¢—É–∞–ª–µ—Ç</option>
            <option value="cafeteria">–°—Ç–æ–ª–æ–≤–∞—è</option>
            <option value="stair">–õ–µ—Å—Ç–Ω–∏—Ü–∞</option>
            <option value="elevator">–õ–∏—Ñ—Ç</option>
            <option value="hall">–ó–∞–ª</option>
            <option value="library">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</option>
          </select>
          <select id="point-floor" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
            <option value="1">1 —ç—Ç–∞–∂</option>
            <option value="2">2 —ç—Ç–∞–∂</option>
            <option value="3">3 —ç—Ç–∞–∂</option>
          </select>
          <div style="display: flex; gap: 10px;">
            <input type="number" id="point-x" placeholder="X" style="flex:1; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
            <input type="number" id="point-y" placeholder="Y" style="flex:1; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
          </div>
          <input type="text" id="point-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" style="width: 100%; padding: 10px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 8px;">
          <button onclick="savePoint()" style="padding: 10px 20px; background: #48bb78; color: white; border: none; border-radius: 8px; margin-right: 10px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button onclick="hideAddForm()" style="padding: 10px 20px; background: #cbd5e0; border: none; border-radius: 8px;">–û—Ç–º–µ–Ω–∞</button>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–æ–∫–∞—Ü–∏–π -->
        <table>
          <thead>
            <tr>
              <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
              <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–≠—Ç–∞–∂</th>
              <th>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody id="points-table">
            <!-- –ë—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
          </tbody>
        </table>
      </div>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ -->
      <div class="panel">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏</h2>
        <a href="/route-editor" style="text-decoration: none;"><button class="add-button">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤</button></a>
        <table>
          <thead>
            <tr>
              <th>–û—Ç–∫—É–¥–∞</th>
              <th>–ö—É–¥–∞</th>
              <th>–¢–æ—á–µ–∫ –ø—É—Ç–∏</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody id="routes-table">
            <!-- –ë—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <footer>
    <p>¬© –ú–ë–û–£ –°–û–® ‚Ññ1</p>
  </footer>

  <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
    function checkPassword() {
      const password = document.getElementById('password-input').value;
      if (password === '–ú–ë–û–£–°–û–®1') {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
        loadData();
      } else {
        document.getElementById('login-error').style.display = 'block';
      }
    }

    function logout() {
      document.getElementById('login-screen').style.display = 'block';
      document.getElementById('admin-panel').style.display = 'none';
      document.getElementById('password-input').value = '';
      document.getElementById('login-error').style.display = 'none';
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadData() {
      await loadPoints();
      await loadRoutes();
      await loadStats();
    }

    async function loadPoints() {
      try {
        const response = await fetch('/api/points');
        const points = await response.json();

        const tbody = document.getElementById('points-table');
        tbody.innerHTML = '';

        points.forEach(point => {
          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${point.name}</td>
            <td>${point.category}</td>
            <td>${point.floor}</td>
            <td>(${point.x}, ${point.y})</td>
            <td>
              <button class="action-button edit" onclick="editPoint('${point.id}')">‚úèÔ∏è</button>
              <button class="action-button delete" onclick="deletePoint('${point.id}')">üóëÔ∏è</button>
            </td>
          `;
        });
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
      }
    }

    async function loadRoutes() {
      try {
        const response = await fetch('/api/routes');
        const routes = await response.json();

        const pointsRes = await fetch('/api/points');
        const points = await pointsRes.json();

        const tbody = document.getElementById('routes-table');
        tbody.innerHTML = '';

        Object.entries(routes).forEach(([key, route]) => {
          const start = points.find(p => p.id === route.startId);
          const end = points.find(p => p.id === route.endId);

          if (!start || !end) return;

          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${start.name}</td>
            <td>${end.name}</td>
            <td>${route.points.length}</td>
            <td>
              <button class="action-button delete" onclick="deleteRoute('${key}')">üóëÔ∏è</button>
            </td>
          `;
        });
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤:', error);
      }
    }

    async function loadStats() {
      try {
        const response = await fetch('/api/stats');
        const stats = await response.json();

        document.getElementById('total-points').textContent = stats.total_points || 0;
        document.getElementById('total-routes').textContent = stats.total_routes || 0;
        document.getElementById('today-stats').textContent = stats.daily_stats?.[new Date().toISOString().split('T')[0]] || 0;
        document.getElementById('total-navigations').textContent = stats.total_navigations || 0;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
      }
    }

    function showAddForm() {
      document.getElementById('add-form').style.display = 'block';
    }

    function hideAddForm() {
      document.getElementById('add-form').style.display = 'none';
    }

    async function savePoint() {
      const point = {
        name: document.getElementById('point-name').value,
        category: document.getElementById('point-category').value,
        floor: parseInt(document.getElementById('point-floor').value),
        x: parseInt(document.getElementById('point-x').value),
        y: parseInt(document.getElementById('point-y').value),
        description: document.getElementById('point-desc').value
      };

      try {
        await fetch('/api/points', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(point)
        });
        hideAddForm();
        loadPoints();
      } catch (error) {
        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
      }
    }

    async function deletePoint(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç–æ—á–∫—É?')) return;

      try {
        await fetch(`/api/points/${id}`, { method: 'DELETE' });
        loadPoints();
      } catch (error) {
        alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
      }
    }

    async function deleteRoute(key) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ä—à—Ä—É—Ç?')) return;

      try {
        const routes = await (await fetch('/api/routes')).json();
        delete routes[key];
        await fetch('/api/routes', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(routes)
        });
        loadRoutes();
      } catch (error) {
        alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
      }
    }

    function editPoint(id) {
      alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
    }
  </script>
</body>
</html>