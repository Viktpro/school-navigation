<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–®–∫–æ–ª–∞ - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫–∞–∫ –≤ Google Maps</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/google-style.css') }}">
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="app-bar">
        <div class="logo">
            <div class="logo-icon">üè´</div>
            <span>–®–∫–æ–ª–∞</span>
        </div>

        <div class="search-section">
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –ë115, –í134...">
            </div>
            <button class="route-swap" id="swap-route" title="–ü–æ–º–µ–Ω—è—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ">‚áÑ</button>
        </div>

        <div class="user-menu">
            <button class="control-btn" id="scan-qr-btn" style="width: 48px;" title="–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥">üì∑</button>
            <button class="control-btn" id="my-location-btn" style="width: 48px;" title="–ú–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">üìç</button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="main-container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="side-panel">
            <div class="panel-header">
                <h2>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫—É–¥–∞ —Ö–æ—Ç–∏—Ç–µ –ø–æ–π—Ç–∏</p>

                <div class="location-badge">
                    <div class="badge-dot"></div>
                    <div class="location-text" id="start-location">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
                    <button class="change-btn" onclick="document.getElementById('start-select').click()">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                </div>

                <div class="location-badge" style="margin-top: 8px; background: #fef7e0;">
                    <div style="width: 12px; height: 12px; background: #e5252d; border-radius: 50%;"></div>
                    <div class="location-text" id="end-location">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
                    <button class="change-btn" onclick="document.getElementById('end-select').click()">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                </div>

                <button class="route-build-btn" id="build-route-btn" style="
                    width: 100%;
                    margin-top: 16px;
                    padding: 12px;
                    background: #1a73e8;
                    color: white;
                    border: none;
                    border-radius: 24px;
                    font-weight: 500;
                    cursor: pointer;
                ">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
            </div>

            <div class="categories">
                <div class="categories-title">–ö–ê–¢–ï–ì–û–†–ò–ò</div>
                <div class="category-list">
                    <span class="category-chip active" data-category="all">–í—Å–µ</span>
                    <span class="category-chip" data-category="classroom">–ö–ª–∞—Å—Å—ã</span>
                    <span class="category-chip" data-category="cafeteria">–ï–¥–∞</span>
                    <span class="category-chip" data-category="toilet">–¢—É–∞–ª–µ—Ç—ã</span>
                    <span class="category-chip" data-category="entrance">–í—Ö–æ–¥—ã</span>
                    <span class="category-chip" data-category="stair">–õ–µ—Å—Ç–Ω–∏—Ü—ã</span>
                    <span class="category-chip" data-category="elevator">–õ–∏—Ñ—Ç—ã</span>
                </div>
            </div>

            <div class="places-list" id="places-list">
                <!-- –°–ø–∏—Å–æ–∫ –º–µ—Å—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <!-- –ö–∞—Ä—Ç–∞ -->
        <div class="map-section">
            <canvas id="floor-plan"></canvas>

            <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="map-controls">
                <button class="control-btn" id="zoom-in" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å">‚ûï</button>
                <button class="control-btn" id="zoom-out" title="–û—Ç–¥–∞–ª–∏—Ç—å">‚ûñ</button>
                <button class="control-btn" id="reset-view" title="–°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥">‚ü≤</button>
            </div>

            <!-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç—Ç–∞–∂–µ–π -->
            <div class="floor-control">
                <button class="floor-btn active" data-floor="1">1</button>
                <button class="floor-btn" data-floor="2">2</button>
                <button class="floor-btn" data-floor="3">3</button>
            </div>

            <!-- –ú–∞—Å—à—Ç–∞–± -->
            <div class="scale-bar">
                <span class="scale-line"></span>
                <span id="scale-value">100 –º</span>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ -->
            <div class="route-card" id="route-card" style="display: none;">
                <div class="route-info">
                    <span class="route-distance" id="route-distance">5 –º–∏–Ω</span>
                    <span class="route-time" id="route-time">350 –º</span>
                </div>
                <div class="route-steps" id="route-steps">
                    –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ 2 —ç—Ç–∞–∂
                </div>
                <button class="close-btn" onclick="this.parentElement.style.display='none'">‚úï</button>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–µ—Å—Ç–µ -->
            <div class="info-card" id="info-card">
                <div class="card-header">
                    <span class="card-title" id="info-title">–ö–ª–∞—Å—Å –ë115</span>
                    <span class="card-category" id="info-category">–ö–ª–∞—Å—Å</span>
                </div>
                <div class="card-description" id="info-description">
                    1 —ç—Ç–∞–∂, –ª–µ–≤–æ–µ –∫—Ä—ã–ª–æ
                </div>
                <div class="card-actions">
                    <button class="card-btn" onclick="window.map.setAsStart()">
                        <span>üìç</span> –û—Ç—Å—é–¥–∞
                    </button>
                    <button class="card-btn primary" onclick="window.map.setAsEnd()">
                        <span>üèÅ</span> –°—é–¥–∞
                    </button>
                    <button class="card-btn" onclick="document.getElementById('info-card').classList.remove('active')">
                        ‚úï
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è QR-—Å–∫–∞–Ω–µ—Ä–∞ -->
    <div id="qr-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; backdrop-filter: blur(5px);">
        <div style="background: white; margin: 10% auto; padding: 24px; border-radius: 24px; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 20px; color: #202124;">üì± –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥</h2>
                <button onclick="document.getElementById('qr-modal').style.display='none'" style="border: none; background: none; font-size: 24px; cursor: pointer;">‚úï</button>
            </div>
            <div id="qr-reader" style="width: 100%; min-height: 300px; border-radius: 16px; overflow: hidden;"></div>
            <p style="text-align: center; margin-top: 16px; color: #5f6368; font-size: 14px;">
                –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥ –Ω–∞ –∫–∞–±–∏–Ω–µ—Ç–µ
            </p>
        </div>
    </div>

    <style>
        .route-build-btn:hover {
            background: #1557b0 !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(26,115,232,0.3);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>

    <script src="{{ url_for('static', filename='js/google-style-map.js') }}"></script>
    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        document.querySelectorAll('.category-chip').forEach(chip => {
            chip.addEventListener('click', function() {
                document.querySelectorAll('.category-chip').forEach(c => c.classList.remove('active'));
                this.classList.add('active');

                const category = this.dataset.category;
                const places = document.querySelectorAll('.place-item');

                places.forEach(place => {
                    if (category === 'all') {
                        place.style.display = 'flex';
                    } else {
                        const point = window.map.points.find(p => p.id === place.dataset.id);
                        place.style.display = point?.category === category ? 'flex' : 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>